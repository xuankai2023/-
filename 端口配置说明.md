# 端口配置说明

## 📋 当前配置

### 前端服务器
- **端口**: `8081`
- **访问地址**: `http://localhost:8081`
- **配置文件**: `vite.config.ts`

### 后端服务器
- **端口**: `8080`
- **访问地址**: `http://localhost:8080`
- **API 前缀**: `/api/v1`

### 代理配置
- **前端请求**: `/api/*` → 自动代理到 `http://localhost:8080/api/*`
- **配置位置**: `vite.config.ts` (第 58-78 行)

## 🔧 配置详情

### vite.config.ts

```typescript
server: {
    port: 8081,  // 前端端口
    open: true,
    proxy: {
        '/api': {
            target: 'http://localhost:8080',  // 后端地址
            changeOrigin: true,
            rewrite: (path) => path.replace(/^\/api/, '/api'),
        }
    }
}
```

### 请求配置 (src/utils/request.ts)

```typescript
const request = axios.create({
    baseURL: 'api',  // 相对路径，会被代理转发
    timeout: 10000,
});
```

## 🚀 启动步骤

### 1. 启动后端服务器

```bash
# 确保后端运行在 8080 端口
# 根据你的后端框架执行相应命令
# 例如 FastAPI:
uvicorn main:app --host 0.0.0.0 --port 8080

# 或者 Spring Boot:
java -jar your-app.jar --server.port=8080
```

### 2. 启动前端开发服务器

```bash
# 在项目根目录执行
npm run dev

# 或者
yarn dev
```

前端会自动启动在 `http://localhost:8081`

### 3. 验证配置

打开浏览器访问：
- 前端: `http://localhost:8081`
- 后端 API: `http://localhost:8080/api/v1/login/test-token` (需要 Token)

## 📡 请求流程

```
浏览器请求: http://localhost:8081/api/v1/users/me
    ↓
Vite 代理拦截: /api/*
    ↓
转发到后端: http://localhost:8080/api/v1/users/me
    ↓
后端处理并返回响应
    ↓
Vite 代理返回给浏览器
```

## ✅ 验证代理是否工作

### 方法 1: 查看浏览器网络请求

1. 打开浏览器开发者工具 (F12)
2. 切换到 "Network" 标签
3. 执行一个 API 请求
4. 查看请求 URL，应该是 `http://localhost:8081/api/...`
5. 查看响应状态码，200 表示成功

### 方法 2: 查看 Vite 控制台

如果配置了代理日志（已配置），会看到：
```
[代理] GET /api/v1/users/me -> http://localhost:8080/api/v1/users/me
```

### 方法 3: 测试 API 连接

在浏览器控制台执行：
```javascript
fetch('/api/v1/login/test-token', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer your-token-here'
  }
})
.then(res => res.json())
.then(data => console.log('API 响应:', data))
.catch(err => console.error('API 错误:', err));
```

## ⚠️ 常见问题

### Q: 前端启动失败，提示端口 8081 被占用？

A: 解决方案：
1. 关闭占用 8081 端口的程序
2. 或者修改 `vite.config.ts` 中的端口号

```bash
# 查找占用端口的进程 (macOS/Linux)
lsof -i :8081

# 或者使用 netstat
netstat -an | grep 8081
```

### Q: 代理不工作，请求返回 404？

A: 检查：
1. 后端服务器是否运行在 8080 端口
2. 后端 API 路径是否正确（应该是 `/api/v1/...`）
3. 查看 Vite 控制台的错误信息

### Q: 出现 CORS 错误？

A: 确保：
1. 使用代理而不是直接请求后端
2. 后端 CORS 配置允许来自 `http://localhost:8081` 的请求

### Q: 如何修改后端端口？

A: 如果后端运行在其他端口（例如 3000），修改 `vite.config.ts`:

```typescript
proxy: {
    '/api': {
        target: 'http://localhost:3000',  // 修改这里
        // ...
    }
}
```

然后重启前端开发服务器。

## 📝 配置检查清单

- [x] 前端端口: 8081
- [x] 后端端口: 8080
- [x] 代理配置: `/api` → `http://localhost:8080`
- [x] 请求 baseURL: `api` (相对路径)
- [x] 后端服务器运行正常
- [x] 前端开发服务器运行正常

## 🔄 重启服务

如果修改了配置，需要：

1. **停止当前服务**: `Ctrl + C`
2. **重启前端**: `npm run dev`
3. **确保后端运行**: 检查后端服务器状态

## 📞 需要帮助？

如果遇到问题：
1. 检查后端服务器日志
2. 查看浏览器控制台错误
3. 查看 Vite 开发服务器控制台
4. 确认端口没有被占用

