{"version":3,"file":"Login-BPLDe12A.js","sources":["../../src/components/Login/Login.tsx"],"sourcesContent":["// src/components/Login/Login.tsx\n\nimport React, { useState, useEffect } from 'react';\nimport { Dialog as Modal, Button } from 'react-vant';\nimport { useNavigate } from 'react-router-dom';\nimport './Login.css';\nimport { useAuthContext } from '../../auth/AuthContext';\n\ninterface LoginProps {\n  visible?: boolean;\n  onClose?: () => void;\n}\n\nconst Login: React.FC<LoginProps> = ({ visible = true, onClose }) => {\n  const navigate = useNavigate();\n  const { login, isLoading: authLoading } = useAuthContext();\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n\n  // ESC 键关闭\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        if (onClose) {\n          onClose();\n        } else {\n          // 如果没有onClose，返回到上一页\n          navigate(-1);\n        }\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [onClose, navigate]);\n\n  const handleLogin = async () => {\n    if (!username.trim()) {\n      setError('用户名不能为空');\n      return;\n    }\n    if (!password.trim()) {\n      setError('密码不能为空');\n      return;\n    }\n\n    setError('');\n\n    // 移除焦点，收起软键盘（移动端友好）\n    (document.activeElement as HTMLElement)?.blur();\n\n    try {\n      // 执行登录\n      const success = await login({ username, password });\n\n      if (success) {\n        // 登录成功：先关闭模态框，再跳转到 admin 页面\n        if (onClose) {\n          onClose();\n        }\n        // 延迟跳转，确保模态框先关闭\n        setTimeout(() => {\n          navigate('/admin', { replace: true });\n        }, 100);\n      } else {\n        setError('用户名或密码错误');\n      }\n    } catch (err) {\n      const errorMessage = err instanceof Error\n        ? err.message\n        : '登录失败，请检查您的凭据';\n      setError(errorMessage);\n    }\n  }; return (\n    <Modal\n      visible={visible}\n      onClose={() => {\n        if (onClose) {\n          onClose();\n        } else {\n          navigate(-1);\n        }\n      }}\n      title=\"管理员登录\"\n      showCancelButton\n      confirmButtonText={authLoading ? \"登录中...\" : \"登录\"}\n      cancelButtonText=\"关闭\"\n      onCancel={() => {\n        if (onClose) {\n          onClose();\n        } else {\n          navigate(-1);\n        }\n      }}\n      onConfirm={authLoading ? undefined : handleLogin}\n      className=\"tiktok-login-modal\"\n      closeOnClickOverlay={false}\n      // 禁用默认确认按钮颜色逻辑，由 CSS 控制\n      confirmButtonColor=\"\"\n    >\n      <div className=\"login-content\">\n        {error && <div className=\"error-message\">{error}</div>}\n\n        <div className=\"form-group\">\n          <label htmlFor=\"username\">Username</label>\n          <input\n            type=\"text\"\n            id=\"username\"\n            className=\"form-input\"\n            placeholder=\"请输入用户名\"\n            value={username}\n            onChange={(e) => setUsername(e.target.value)}\n            disabled={authLoading}\n            autoComplete=\"username\"\n            autoFocus\n            aria-label=\"Username\"\n          />\n        </div>\n\n        <div className=\"form-group\">\n          <label htmlFor=\"password\">Password</label>\n          <input\n            type={showPassword ? 'text' : 'password'}\n            id=\"password\"\n            className=\"form-input\"\n            placeholder=\"请输入密码\"\n            value={password}\n            onChange={(e) => setPassword(e.target.value)}\n            disabled={authLoading}\n            autoComplete=\"current-password\"\n            aria-label=\"Password\"\n          />\n          <button\n            type=\"button\"\n            className=\"toggle-password-btn\"\n            onClick={() => setShowPassword(!showPassword)}\n            disabled={authLoading}\n            aria-label={showPassword ? 'Hide password' : 'Show password'}\n          >\n            {showPassword ? 'Hide' : 'Show'}\n          </button>\n        </div>\n\n        <button\n          type=\"button\"\n          className=\"forgot-password\"\n          onClick={() => alert('忘记密码? 请联系管理员')}\n          disabled={authLoading}\n        >\n          忘记密码?\n        </button>\n      </div>\n    </Modal>\n  );\n};\n\nexport default Login;"],"names":["Login","__name","visible","onClose","navigate","useNavigate","login","authLoading","useAuthContext","username","setUsername","useState","password","setPassword","error","setError","showPassword","setShowPassword","useEffect","handleKeyDown","e","handleLogin","_a","err","errorMessage","jsx","Modal","jsxs"],"mappings":"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"}