# 快速开始 - 前后端联调

## 一、配置步骤（5分钟完成）

### 步骤 1: 创建环境变量文件

在项目根目录创建 `.env.development` 文件：

```bash
# 在项目根目录执行
cp .env.example .env.development
```

或者手动创建 `.env.development` 文件，内容如下：
```env
VITE_API_BASE_URL=/api
```

### 步骤 2: 确认 Vite 代理配置

已自动配置完成！`vite.config.ts` 中已添加代理配置：

```typescript
server: {
    port: 8000,
    open: true,
    proxy: {
        '/api': {
            target: 'http://localhost:8080',
            changeOrigin: true,
            rewrite: (path) => path.replace(/^\/api/, '/api'),
        }
    }
}
```

### 步骤 3: 启动服务

#### 启动后端（确保在 8080 端口）
```bash
# 在你的后端项目目录
# 根据你的后端框架执行相应命令
# 例如：npm start, python app.py, java -jar app.jar 等
```

#### 启动前端
```bash
# 在项目根目录
npm run dev
```

前端将自动运行在 `http://localhost:8000`

### 步骤 4: 验证连接

1. 打开浏览器访问 `http://localhost:8000`
2. 打开浏览器开发者工具（F12）
3. 切换到 Network 标签
4. 执行一个需要调用后端接口的操作（如登录）
5. 查看请求是否成功发送到后端

## 二、请求流程说明

### 开发环境请求流程

```
前端代码: api.get('/users')
    ↓
Axios 请求: /api/users (相对路径)
    ↓
Vite 开发服务器接收
    ↓
代理转发到: http://localhost:8080/api/users
    ↓
后端处理并返回响应
    ↓
响应通过代理返回前端
```

### 关键点

1. **前端请求使用相对路径**: `/api/xxx`，不要使用完整 URL
2. **Vite 自动代理**: 所有 `/api` 开头的请求会自动转发到 `http://localhost:8080`
3. **解决跨域问题**: 通过代理避免了浏览器的跨域限制

## 三、测试接口连接

### 方法 1: 使用浏览器控制台

打开浏览器控制台，执行：

```javascript
// 测试基础连接
fetch('/api/health')
  .then(res => res.json())
  .then(data => console.log('连接成功:', data))
  .catch(err => console.error('连接失败:', err));
```

### 方法 2: 使用 curl

```bash
# 测试后端是否正常运行
curl http://localhost:8080/api/health

# 测试登录接口
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'
```

### 方法 3: 使用 Postman

1. 创建新请求
2. URL: `http://localhost:8080/api/auth/login`
3. Method: POST
4. Body: 选择 raw -> JSON
5. 输入测试数据并发送

## 四、常见问题排查

### 问题 1: 代理不生效

**症状**: 请求返回 404 或直接请求前端服务器

**解决方案**:
1. 确认 `vite.config.ts` 中代理配置正确
2. 重启前端开发服务器（`npm run dev`）
3. 确认请求路径以 `/api` 开头

### 问题 2: 后端连接失败

**症状**: Network Error 或连接超时

**排查步骤**:
1. 确认后端服务已启动
2. 确认后端运行在 8080 端口
3. 测试直接访问后端: `curl http://localhost:8080/api/health`
4. 检查防火墙设置

### 问题 3: CORS 错误

**症状**: 浏览器控制台显示 CORS 相关错误

**解决方案**:
- 如果使用代理，不应该出现 CORS 错误
- 如果出现，检查代理配置是否正确
- 或者让后端配置 CORS 允许 `http://localhost:8000`

### 问题 4: 401 未授权

**症状**: 请求返回 401 Unauthorized

**排查步骤**:
1. 检查 Token 是否正确设置
2. 检查 Token 是否过期
3. 确认请求头格式: `Authorization: Bearer <token>`
4. 检查后端 Token 验证逻辑

## 五、接口调用示例

### 在 React 组件中调用接口

```typescript
import { api } from '@/utils/request';

// 获取宠物列表
const fetchPets = async () => {
  try {
    const data = await api.get('/pets?page=1&pageSize=10');
    console.log('宠物列表:', data);
  } catch (error) {
    console.error('获取失败:', error);
  }
};

// 创建订单
const createOrder = async (orderData: any) => {
  try {
    const data = await api.post('/orders', orderData);
    console.log('订单创建成功:', data);
  } catch (error) {
    console.error('创建失败:', error);
  }
};
```

### 使用 useEffect 调用

```typescript
import { useEffect, useState } from 'react';
import { api } from '@/utils/request';

function PetList() {
  const [pets, setPets] = useState([]);

  useEffect(() => {
    const loadPets = async () => {
      try {
        const data = await api.get('/pets');
        setPets(data.items || []);
      } catch (error) {
        console.error('加载失败:', error);
      }
    };
    
    loadPets();
  }, []);

  return (
    <div>
      {pets.map(pet => (
        <div key={pet.id}>{pet.name}</div>
      ))}
    </div>
  );
}
```

## 六、下一步

1. **查看详细文档**:
   - `前后端联调计划.md` - 完整的联调计划
   - `API接口联调文档.md` - 详细的接口文档

2. **开始联调**:
   - 按照接口文档逐个测试接口
   - 记录遇到的问题和解决方案
   - 更新接口文档（如有变更）

3. **优化开发体验**:
   - 配置接口 Mock 数据（开发阶段）
   - 使用 TypeScript 类型定义接口响应
   - 添加请求/响应日志

## 七、生产环境配置

当部署到生产环境时：

1. 创建 `.env.production` 文件
2. 设置实际的后端 API 地址：
   ```env
   VITE_API_BASE_URL=https://api.yourdomain.com/api
   ```
3. 构建生产版本：
   ```bash
   npm run build
   ```

注意：生产环境不使用代理，直接请求后端地址。

